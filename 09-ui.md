---
layout: default
title: UI系统
---

# 第九章、UI系统
{:.no_toc}

> **_横看成岭侧成峰，远近高低各不同。不识庐山真面目，只缘身在此山中。_**  
>   
> --- 【宋】苏轼 《题西林壁》

* 目录
{:toc}

## 课程内容与资源

![](images/game-architecture-ui.png)

**1、资源下载**

![](images/drf/open_alt.png) [Game Jam Menu Template](https://github.com/pmlpml/unity3d-learning/raw/ex-ui/zips/Game%20Jam%20Menu%20Template.zip)

![](images/drf/open_alt.png) [Unity 官方实例 ：SampleUI](https://github.com/pmlpml/unity3d-learning/raw/ex-ui/zips/SampleUI.zip)

**2、相关知识**

* [对象方法扩展 和 Dotween 的实践](x3-07-method-extend-lambda)


## 1、Unity UI 技术概述

### 1.1 Unity GUI 简介

UI 即 User Interface（用户界面）的简称。在许多软件中，采用狭义的概念，特指窗体、面板、按钮、文本框等人们熟悉的人机交互元素，及其组织与风格（也称皮肤）。Unity UI 系统采用上述狭义概念。

Unity 目前支持两套完全不同风格的 UI 系统：

* IMGUI（Immediate Mode GUI）及时模式图形界面。它是代码驱动的 UI 系统，即没有图形化设计界面，只能在 OnGUI 阶段用 GUI 系列的类绘制各种 UI 元素。 
* Unity GUI /  UGUI 是面向对象的 UI 系统。所有 UI 元素都是游戏对象，有友好的图形化设计界面， 在场景渲染阶段渲染这些 UI 元素。

### 1.2 IMGUI 过时了？

IMGUI 的存在符合游戏编程的传统，即使在今天它依然没有被官方宣判为遗留（将要淘汰的）系统（Legacy Systems）。在修改模型，渲染模型这样的经典游戏循环编程模式中，在渲染阶段之后，绘制 UI 界面无可挑剔（参考[Execution Order of Event Functions](https://docs.unity3d.com/Manual/ExecutionOrder.html)）。这样的编程即避免了 UI 元素保持在屏幕最前端，又有最佳的执行效率，一切控制掌握在程序员手中，这对早期计算和存储资源贫乏的游戏设备来说，更是弥足珍贵。当然，早年 UI 交互手段就是绘制图片和文本，检测输入事件等基本任务。

按 Unity 官方说法，IMGUI 主要用于以下[场景](https://docs.unity3d.com/Manual/GUIScriptingGuide.html)：

* 在游戏中创建调试显示工具
* 为脚本组件创建自定义的 Inspector 面板。
* 创建新的编辑器窗口和工具来扩展 Unity 环境。

IMGUI系统通常不打算用于玩家可能使用并与之交互的普通游戏内用户界面。为此，应该使用 Unity 的基于 GameObject 的 UGUI 系统。

显然，如果不做复杂的界面，如下代码简单易用的代码是程序员喜欢的：

```cs
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class IMGUITest : MonoBehaviour {

	void OnGUI (){
		// Make a background box
		GUI.Box(new Rect(10,10,100,90), "Loader Menu");

		// Make the first button. If it is pressed, Application.Loadlevel (1) will be executed
		if(GUI.Button(new Rect(20,40,80,20), "Level 1")) {
			Application.LoadLevel(1);
		}

		// Make the second button.
		if(GUI.Button(new Rect(20,70,80,20), "Level 2")) {
			Application.LoadLevel(2);
		}
	}
}
```

因此，掌握了解 IMGUI 是非常必要：

* 新手 UI 入门容易，帮助新手理解引擎的游戏循环
* 高级程序员，创建在线调试环境
* 工具开发者，定义 Unity 新的编程工具

### 1.3 UGUI 的产生与优势

随着游戏开发的普及，为了让设计师也能参与参与程序开发，从简单的地图编辑器、菜单编辑器等工具应运而生。设计师甚至不需要程序员帮助，使用这些工具就可直接创造游戏元素，乃至产生游戏程序。除此之外，现代游戏 UI 必须要满足以下要求：

* 跨设备执行，自动适应不同分辨率
* UI 元素与游戏场景融为一体的交互
* 复杂的布局
* 多摄像机支持

以至于即使优秀的程序员在现代 UI 面前，传统代码驱动的 UI 面临效率低下，难以调试等问题。 对于 Unity 平台， 当 [NGUI](http://www.tasharen.com/?page_id=140): Next-Gen UI kit 的出现使得不依赖 Unity Pro 功能，使用所见即所得（WYSIWYG）设计工具，集成了 tweening 运动管理系统， 可以制作多数 2D 游戏，直接威胁了 Unity 的生意。 Unity 最终高薪聘了 NGUI 的主设计师，最终又分道扬镳，于是就有了 UGUI，青出于蓝而胜于蓝！

UGUI 的优势：

* 所见即所得（WYSIWYG）设计工具
* 支持多模式、多摄像机渲染
* 面向对象的编程

## 2、UGUI 基础

本部分内容主要来自官方手册。  请参考 [UI 系统](https://docs.unity3d.com/Manual/UISystem.html)

### 2.1 画布

画布（Cavas）是绘图区域, 同时是 ui 元素的容器。 容器中 ui 元素及其子 UI 元素都将绘制在其上。 拥有Canvas组件的游戏对象都有一个画布，它空间中的子对象，如果是 UI 元素将渲染在画布上。

画布区域在场景视图中显示为矩形。这使得定位UI元素变得非常容易，无需随时显示游戏运行视图。

**1、UI元素的显示顺序**

画布中的UI元素按照它们在层次结构中出现的顺序绘制。如果两个UI元素重叠，后面的元素将出现在较早的元素之上。因此，最后一个孩子显示在最上面。

要更改哪些元素出现在其他元素的顶部，通过拖动它们在 Hierarchy 视图中的位置。这顺序也可以通过 Transform 组件的方法在脚本中控制。 如：SetAsFirstSibling，SetAsLastSibling 和SetSiblingIndex。

**2、渲染模式**

画布组件有渲染模式（Render Mode）设置，可用于使其在屏幕空间（Screen Space）或世界空间（World Space）中渲染。

![](images/drf/library_bookmarked.png) UI元素采用像素单位表示位置和尺寸， UI元素默认在 UI 层

**屏幕空间 - 叠加（Screen Space - Overlay）**

将UI元素放置在场景顶部渲染的屏幕，画布会自动更改大小匹配屏幕。Canvas 默认中心点为屏幕中心！

![](https://docs.unity3d.com/uploads/Main/GUI_Canvas_Screenspace_Overlay.png)


**屏幕空间 - 相机（Screen Space - Camera）**

画布放在制定的渲染摄像机前，如 100 的位置，画布会自动匹配为屏幕分辨率。Canvas 默认中心点为屏幕中心！
![](https://docs.unity3d.com/uploads/Main/GUI_Canvas_Screenspace_Camera.png)

**世界空间（World Space）**

画布行为与场景中的其他任何对象一样，UI元素将放置在其他对象的前面或后面渲染。**画布大小和位置任意设置**，这对于意在成为世界一部分的用户界面非常有用。

![](https://docs.unity3d.com/uploads/Main/GUI_Canvas_Worldspace.png)

**3、测试渲染模式**

![](images/drf/movies.png) 操作 09-1：

* 菜单 GameObject -\> UI -\> Button

在游戏对象层次视图中出现 Canvas 和 EventSystem。

* 展开 Canvas 看到 Buttion
* 展开 Button 看到 Text
* 菜单 GameObject -\> 3D Object -\> Cube 添加 Cube 作为参考物
* 检查、设置以下对象属性
    - Main Camera 的 Position = （0，1，-10）
    - Canvas::Button 的 （PosX,PosY,PosZ） = (0,0,0)
    - Cube 的 Position = （0，**0.5**，0）
* 使用鼠标中间滚轮在场景视图中缩小，直到看到整个画布，中间有一个 Button

研究渲染模式：

* 选择 Canvas 对象的 Inspector 面板中 Canvas 组件
    - 设置 Render Mode 为 Screen Space - Overlay

在 Game 视图中，看到按钮覆盖在 Cube 上。

* 选择 Canvas 对象的 Inspector 面板中 Canvas 组件
    - 设置 Render Mode 为 Screen Space - Camera
    - 设置 Render Camera 为 Main Camera

结果在  Game 视图中，看到按钮在 Cube 后面。

* 选择 Main Camera
    - 在  Camera 组件面板中修改 Field of View

在 Game 视图中，Cube 变化大小，而按钮保持不变。

* 切换到 Scene 视图
* 在  Camera 组件面板中修改 Field of View

观察到画布随着视口自动改变大小。

![](images/drf/ichat.png) Cube 变化大小，按钮保持不变。 为什么？





## 5、作业与练习

**以下作业四选一：**

1、血条（Health Bar）制作。具体要求如下
    
* 分别使用 IMGUI 和 UGUI 实现
* 使用 UGUI，血条是游戏对象的一个子元素，任何时候需要面对主摄像机
* 分析两种实现的优缺点

2、 UI 效果制作（你仅需要实现以下效果之一）

* 进入 [NGUI](http://www.tasharen.com/?page_id=140) 官方网站，使用 UGUI 实现以下效果 
    - [Inventory](http://www.tasharen.com/ngui/exampleX.html) 背包系统
    - [Quest Log](http://www.tasharen.com/ngui/example9.html) 公告牌
    - [Scroll View](http://www.tasharen.com/ngui/example7.html) 选择板
* 以上例子需要使用 Unity web player， 仅支持以下操作系统与浏览器，参见[官方下载](https://unity3d.com/cn/webplayer)
    - Windows 版 **IE11**
    - **Mac OS X 10.7**  Safari
    - 出现界面需要等待较长时间，打开页面让它慢慢加载

3、 如果你觉得 UI 不是你的菜，喜欢复杂的设计与代码

* 研究 DOTween 网站 http://dotween.demigiant.com/getstarted.php 网页， 它在 Specific settings 中 transform.DoMove 返回 Tween 对象。请实现该对象，实现对动作的持续管理。
    - 本作业有较大难度，**务必参考师兄的作业**

4、如果你喜欢凭空构思场景，请自制有趣的 UI 场景

*  例如：“几个小动物（3D）开会，语句从每个动物头上飘出，当达到一个大小，会出现清晰的文字！如果文字较多，会自动滚动”

